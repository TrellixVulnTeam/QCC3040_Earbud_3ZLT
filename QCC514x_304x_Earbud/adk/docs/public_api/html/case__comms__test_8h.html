<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Public API: adk/src/common/adk_test/case_comms/case_comms_test.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Public API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('case__comms__test_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">case_comms_test.h File Reference<div class="ingroups"><a class="el" href="group__adk__test__common.html">Test APIs</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Interface to case comms testing functions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:af86ab9e0560712d56d56dedf72d249aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="case__comms__test_8h.html#af86ab9e0560712d56d56dedf72d249aa">CaseCommsTest_Init</a> (unsigned max_msg_len)</td></tr>
<tr class="memdesc:af86ab9e0560712d56d56dedf72d249aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the case comms test API before use.  <a href="case__comms__test_8h.html#af86ab9e0560712d56d56dedf72d249aa">More...</a><br /></td></tr>
<tr class="separator:af86ab9e0560712d56d56dedf72d249aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e46c259b6a61031a8961691f524b483"><td class="memItemLeft" align="right" valign="top">uint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="case__comms__test_8h.html#a4e46c259b6a61031a8961691f524b483">CaseCommsTest_PollRxMsgLen</a> (void)</td></tr>
<tr class="memdesc:a4e46c259b6a61031a8961691f524b483"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get length of message received by this device.  <a href="case__comms__test_8h.html#a4e46c259b6a61031a8961691f524b483">More...</a><br /></td></tr>
<tr class="separator:a4e46c259b6a61031a8961691f524b483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1f2ff54cbd977b24bd7a569b75ad596"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__case__comms.html#gaad2a1fef90d5f9b28e5eaaeda93c15f5">cc_tx_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="case__comms__test_8h.html#ae1f2ff54cbd977b24bd7a569b75ad596">CaseCommsTest_PollTxStatus</a> (void)</td></tr>
<tr class="memdesc:ae1f2ff54cbd977b24bd7a569b75ad596"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the transmit status of the last transmitted message.  <a href="case__comms__test_8h.html#ae1f2ff54cbd977b24bd7a569b75ad596">More...</a><br /></td></tr>
<tr class="separator:ae1f2ff54cbd977b24bd7a569b75ad596"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa25f8aaa9ddadbb06f5c880698f157cf"><td class="memItemLeft" align="right" valign="top">uint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="case__comms__test_8h.html#aa25f8aaa9ddadbb06f5c880698f157cf">CaseCommsTest_RxMsg</a> (uint8 *msg)</td></tr>
<tr class="memdesc:aa25f8aaa9ddadbb06f5c880698f157cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive message transmitted to this device.  <a href="case__comms__test_8h.html#aa25f8aaa9ddadbb06f5c880698f157cf">More...</a><br /></td></tr>
<tr class="separator:aa25f8aaa9ddadbb06f5c880698f157cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55172f4366ca88f832cf37a6ffe87fac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="case__comms__test_8h.html#a55172f4366ca88f832cf37a6ffe87fac">CaseCommsTest_TxMsg</a> (<a class="el" href="group__case__comms.html#ga404a82c0154a2a769616b90029801c09">cc_dev_t</a> dest, unsigned mid, uint8 *msg, uint16 len, bool expect_response)</td></tr>
<tr class="memdesc:a55172f4366ca88f832cf37a6ffe87fac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transmit a case comms message.  <a href="case__comms__test_8h.html#a55172f4366ca88f832cf37a6ffe87fac">More...</a><br /></td></tr>
<tr class="separator:a55172f4366ca88f832cf37a6ffe87fac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interface to case comms testing functions. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2021 Qualcomm Technologies International, Ltd. All Rights Reserved. Qualcomm Technologies International, Ltd. Confidential and Proprietary.</dd></dl>
<p><br  />
</p>
<p>This component provides an API for test scripts to exercise the case comms protocol functionality provided by the cc_protocol component in the case_comms domain.</p>
<p>Scripts must call <a class="el" href="case__comms__test_8h.html#af86ab9e0560712d56d56dedf72d249aa" title="Initialise the case comms test API before use.">CaseCommsTest_Init()</a> before using any other API, this registers this component as the user of the CASECOMMS_CID_TEST case comms channel.</p>
<p>After completion of tests using this API the DUT should be rebooted, no provision is made to free allocated memory or unregister the test channel with case comms.</p>
<p>To transmit a message:</p><ul>
<li>Call <a class="el" href="case__comms__test_8h.html#a55172f4366ca88f832cf37a6ffe87fac" title="Transmit a case comms message.">CaseCommsTest_TxMsg()</a><ul>
<li>Check return value that message has been accepted for transmission</li>
</ul>
</li>
<li>Poll <a class="el" href="case__comms__test_8h.html#ae1f2ff54cbd977b24bd7a569b75ad596" title="Get the transmit status of the last transmitted message.">CaseCommsTest_PollTxStatus()</a> to check status of transmitted message<ul>
<li>will initially return CASECOMMS_STATUS_UNKNOWN which should then change to a status indicating result of the transmission, for example CASECOMMS_TX_SUCCESS where message acknowledged. However, the test script could setup a failure scenario and test for an expected CASECOMMS_TX_FAIL status.</li>
</ul>
</li>
</ul>
<p>To receive a message...</p><ul>
<li>Poll <a class="el" href="case__comms__test_8h.html#a4e46c259b6a61031a8961691f524b483" title="Get length of message received by this device.">CaseCommsTest_PollRxMsgLen()</a><ul>
<li>will initially return 0, but will return non-zero value when message is received</li>
</ul>
</li>
<li>Allocate memory of size returned by <a class="el" href="case__comms__test_8h.html#a4e46c259b6a61031a8961691f524b483" title="Get length of message received by this device.">CaseCommsTest_PollRxMsgLen()</a></li>
<li>Call <a class="el" href="case__comms__test_8h.html#aa25f8aaa9ddadbb06f5c880698f157cf" title="Receive message transmitted to this device.">CaseCommsTest_RxMsg()</a> passing pointer to allocated memory to retrieve the received message.</li>
</ul>
<p>Up to 8 queued messages can be handled by this test interface, this can be increased by changing the NUM_QUEUED_TRANSACTIONS definition.</p>
<p>For example <a class="el" href="case__comms__test_8h.html#a55172f4366ca88f832cf37a6ffe87fac" title="Transmit a case comms message.">CaseCommsTest_TxMsg()</a> can be called 8 times before starting to poll for transmit status with <a class="el" href="case__comms__test_8h.html#ae1f2ff54cbd977b24bd7a569b75ad596" title="Get the transmit status of the last transmitted message.">CaseCommsTest_PollTxStatus()</a> to support testing of queued messaging.</p>
<p>Similarly, up to 8 messages can be received and buffered (within the limits of available heap memory) by a destination device.</p>
<p>Note that receipt of a message when all slots of the receive buffer are full will result in the incoming message being discarded. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af86ab9e0560712d56d56dedf72d249aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af86ab9e0560712d56d56dedf72d249aa">&#9670;&nbsp;</a></span>CaseCommsTest_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CaseCommsTest_Init </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>max_msg_len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the case comms test API before use. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">max_msg_len</td><td>Maximum size of message the test API should support.</td></tr>
  </table>
  </dd>
</dl>
<p>Registers case comms test APIs with case comms domain to use the test channel, and allocates memory for handlings test messages.</p>
<dl class="section note"><dt>Note</dt><dd>Must be called before another other API in this interface can be used. </dd></dl>

</div>
</div>
<a id="a4e46c259b6a61031a8961691f524b483"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e46c259b6a61031a8961691f524b483">&#9670;&nbsp;</a></span>CaseCommsTest_PollRxMsgLen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16 CaseCommsTest_PollRxMsgLen </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get length of message received by this device. </p>
<dl class="section return"><dt>Returns</dt><dd>uint16 Size of received message in bytes.</dd></dl>
<p>Scripts can poll this function for a non-zero value, which indicates a message has been received and the length of that message. The returned value indicates how much memory must be allocated in order to pass the pointer to that memory to CaseCommsTest_GetRxMsg() in order to read the received message. </p>

</div>
</div>
<a id="ae1f2ff54cbd977b24bd7a569b75ad596"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1f2ff54cbd977b24bd7a569b75ad596">&#9670;&nbsp;</a></span>CaseCommsTest_PollTxStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__case__comms.html#gaad2a1fef90d5f9b28e5eaaeda93c15f5">cc_tx_status_t</a> CaseCommsTest_PollTxStatus </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the transmit status of the last transmitted message. </p>
<dl class="section return"><dt>Returns</dt><dd>cc_tx_status_t CASECOMMS_TX_SUCCESS last message was transmitted and acknowledged by the destination device. CASECOMMS_TX_FAIL last message was transmitted but not acknowledged. </dd></dl>

</div>
</div>
<a id="aa25f8aaa9ddadbb06f5c880698f157cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa25f8aaa9ddadbb06f5c880698f157cf">&#9670;&nbsp;</a></span>CaseCommsTest_RxMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16 CaseCommsTest_RxMsg </td>
          <td>(</td>
          <td class="paramtype">uint8 *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive message transmitted to this device. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to memory location in which the received message will be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint16 Size of message written to msg.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>After calling this function, the recorded length of the received message is reset to zero, so scripts can again call CaseCommsTest_GetMsgLen() to check for further received messages. </dd></dl>

</div>
</div>
<a id="a55172f4366ca88f832cf37a6ffe87fac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55172f4366ca88f832cf37a6ffe87fac">&#9670;&nbsp;</a></span>CaseCommsTest_TxMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CaseCommsTest_TxMsg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__case__comms.html#ga404a82c0154a2a769616b90029801c09">cc_dev_t</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8 *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>expect_response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transmit a case comms message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dest</td><td>Destination device to transmit message to. </td></tr>
    <tr><td class="paramname">mid</td><td>Message ID of test message. </td></tr>
    <tr><td class="paramname">msg</td><td>Pointer to memory containing message to transmit. </td></tr>
    <tr><td class="paramname">len</td><td>Length of message </td></tr>
    <tr><td class="paramname">expect_response</td><td>TRUE if message expects a response, otherwise FALSE </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool TRUE if message accepted for transmission to dest, otherwise FALSE</dd></dl>
<dl class="section note"><dt>Note</dt><dd>expect_response is only valid on device in case mode. This will cause the case comms protocol to poll the destination for a response where it is still outstanding.</dd>
<dd>
When scripts call this API, the transmit status is reset to CASECOMMS_STATUS_UNKNOWN, scripts can then poll CaseCommsTest_GetTxStatus() to check for an expected CASECOMMS_TX_SUCCESS (or other) status, indicating the message was transmitted and acknowledged by the destination device. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_7b00319619c21a4b90a047909cc044bd.html">adk</a></li><li class="navelem"><a class="el" href="dir_10a3b2cf5fc7d9033db3826cbdb4b50c.html">src</a></li><li class="navelem"><a class="el" href="dir_60cf253e3988f9474fa07f0342a62986.html">common</a></li><li class="navelem"><a class="el" href="dir_9652863fdcd65882b0a31a879c132b00.html">adk_test</a></li><li class="navelem"><a class="el" href="dir_297edb4b591fb37292dacb670fa27672.html">case_comms</a></li><li class="navelem"><a class="el" href="case__comms__test_8h.html">case_comms_test.h</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
